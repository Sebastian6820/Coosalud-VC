--compensación
SELECT 
SUBSTRING(PERIODO_A_COMPENSAR,4,4) Years,
SUBSTRING(PERIODO_A_COMPENSAR,1,2) Months,
COUNT(*),
ROUND(SUM(PROVISION_DE_INCAPACIDADES_A_RECONOCER))
FROM DWH_PRODUCCION.VAULT_FUENTES.S_ADR_COMPENSACIONES
--WHERE SUBSTRING(PERIODO_A_COMPENSAR,4,4) IN ('2022','2023')
GROUP BY 1,2

--compensación 2
SELECT 
SUBSTRING(FECHA_DEL_PROCESO_DE_COMPENSACION,7,4) Years,
SUBSTRING(FECHA_DEL_PROCESO_DE_COMPENSACION,4,2) Months,
COUNT(*),
ROUND(SUM(PROVISION_DE_INCAPACIDADES_A_RECONOCER))
FROM DWH_PRODUCCION.VAULT_FUENTES.S_ADR_COMPENSACIONES
WHERE SUBSTRING(FECHA_DEL_PROCESO_DE_COMPENSACION,7,4) IN ('2022','2023')
GROUP BY 1,2


--pagado
SELECT 
SUBSTRING(FEC_INICIO_AJUSTADA ,1,4) Years,
SUBSTRING(FEC_INICIO_AJUSTADA ,6,2) Months,
COUNT(*),
ROUND(SUM(VALOR_LIQ_PE))
FROM DW_CICLO_INGRESO_UPC.VAULT_FUENTES.VW_INCAPACIDADES
WHERE SUBSTRING(FEC_INICIO_AJUSTADA ,1,4) IN ('2022','2023') 
and FECHA_PAGO IS NOT NULL AND TIPO_CONTIG = 'INC' AND VALOR_LIQ_PE > 0
GROUP BY 1,2

--pendiente por pagar
SELECT 
SUBSTRING(FEC_INICIO_AJUSTADA ,1,4) Years,
SUBSTRING(FEC_INICIO_AJUSTADA ,6,2) Months,
COUNT(*),
ROUND(SUM(VALOR_LIQ_PE))
FROM DW_CICLO_INGRESO_UPC.VAULT_FUENTES.VW_INCAPACIDADES
WHERE SUBSTRING(FEC_INICIO_AJUSTADA ,1,4) IN ('2022','2023') 
and FECHA_PAGO IS NULL AND TIPO_CONTIG = 'INC' AND ESTADO_LIQ IN ('EP','LI','PR') AND VALOR_LIQ_PE >=0
GROUP BY 1,2
